# Ankismart 更新日志

本文档记录 Ankismart 项目的主要功能变更和版本历史。

## [v0.1.0] - 2024-02-12

### 核心功能

#### 文档转换
- ✅ 支持多种文档格式转换为 Markdown
  - Word 文档 (`.docx`)
  - PowerPoint 演示文稿 (`.pptx`)
  - PDF 文档 (`.pdf`)
  - 图片文件 (`.png`, `.jpg`, `.jpeg`, `.bmp`, `.tiff`, `.webp`)
  - Markdown 文件 (`.md`)
  - 纯文本文件 (`.txt`)
- ✅ 基于 PaddleOCR 的 OCR 文字识别
  - 支持中英文混合识别
  - 升级到 PP-OCRv5 模型
  - 支持逐页进度回调
  - OCR 模型按需下载
- ✅ 文档转换缓存机制
  - 基于文件哈希的智能缓存
  - 避免重复转换相同文件
- ✅ OCR 纠错功能
  - 使用 LLM 自动纠正 OCR 识别错误
  - 可选启用/禁用

#### 卡片生成
- ✅ 多种卡片生成策略
  - `basic` - 基础问答卡片
  - `cloze` - 填空题卡片
  - `concept` - 概念解释卡片
  - `key_terms` - 关键术语卡片
  - `single_choice` - 单选题卡片
  - `multiple_choice` - 多选题卡片
  - `image_qa` - 图片问答卡片
  - `image_occlusion` - 图片遮挡卡片
- ✅ 支持多个 LLM 提供商
  - OpenAI
  - DeepSeek
  - Moonshot (月之暗面)
  - 智谱 AI (Zhipu)
  - 通义千问 (Qwen)
  - Ollama (本地部署)
- ✅ LLM 调用优化
  - 自动重试机制（指数退避）
  - RPM 限流（每分钟请求数控制）
  - Token 使用统计
  - 代理支持
- ✅ 长文档自动分割
  - 智能段落边界分割
  - 保持代码块和表格完整性
  - 可配置分割阈值（默认 70000 字符）

#### Anki 集成
- ✅ AnkiConnect 在线推送
  - 实时推送卡片到 Anki 桌面端
  - 支持多种更新模式
    - `create_only` - 仅创建新卡片
    - `update_only` - 仅更新已存在的卡片
    - `create_or_update` - 创建或更新
  - 批量推送优化
  - 推送结果详细统计
- ✅ APKG 离线导出
  - 使用 genanki 生成 .apkg 文件
  - 支持媒体附件（图片、音频、视频）
  - 支持多牌组导出
  - 自动处理媒体文件（本地路径、URL、Base64）
- ✅ 卡片验证
  - 字段完整性检查
  - 牌组和笔记类型验证
  - 重复检测

#### 用户界面
- ✅ 现代化 Fluent Design 界面
  - 基于 PySide6 和 QFluentWidgets
  - 响应式布局
  - 流畅的动画效果
- ✅ 多页面导航
  - 导入页面 - 文档选择和批量导入
  - 预览页面 - Markdown 预览
  - 结果页面 - 卡片展示和编辑
  - 设置页面 - 配置管理
- ✅ 卡片编辑功能
  - 逐张编辑卡片内容
  - Markdown 语法高亮
  - 实时预览
  - 批量删除
- ✅ 主题支持
  - 浅色主题
  - 深色主题
  - 自动跟随系统
- ✅ 国际化支持
  - 中文界面
  - 英文界面
  - 动态语言切换
- ✅ 异步任务处理
  - 后台线程执行耗时操作
  - 实时进度显示
  - 任务取消支持
  - 状态栏实时反馈

#### 配置管理
- ✅ YAML 配置文件
  - 人类可读的配置格式
  - 支持多 LLM 提供商配置
  - 敏感信息自动加密（API Key）
- ✅ 配置持久化
  - 记住上次使用的设置
  - 窗口位置和大小保存
  - 主题和语言偏好保存
- ✅ 环境变量支持
  - `ANKISMART_APP_DIR` - 自定义应用目录
  - `ANKISMART_CONFIG_PATH` - 自定义配置文件路径

#### 日志和追踪
- ✅ 结构化日志系统
  - JSON 格式日志输出
  - 可配置日志级别
  - 上下文信息记录
- ✅ 性能追踪
  - 每个请求分配唯一 trace_id
  - 关键操作耗时统计
  - 性能指标收集
- ✅ 错误处理
  - 统一的错误码体系
  - 详细的错误信息
  - 异常追踪

### 技术栈

- **Python**: 3.11+
- **GUI 框架**: PySide6 6.6+
- **UI 组件库**: pyside6-fluent-widgets 1.5+
- **LLM 客户端**: openai 1.0+
- **OCR 引擎**: paddleocr 2.7+, paddlepaddle 2.5+
- **Anki 集成**: genanki 0.13+
- **数据验证**: pydantic 2.0+
- **文档解析**: python-docx 1.0+, python-pptx 0.6+
- **PDF 处理**: pypdfium2 4.30+
- **HTTP 客户端**: httpx 0.25+
- **配置管理**: pyyaml 6.0+
- **加密**: cryptography 41.0+

### 测试和质量保证

- ✅ 单元测试框架 (pytest)
- ✅ 测试覆盖率报告 (pytest-cov)
- ✅ 代码检查和格式化 (ruff)
- ✅ 类型注解

---

## 详细变更记录

### 2024-02-12

#### UI 重构快照
- 保存当前 UI 重构进度
- 完成多语言支持
- 完成界面交互增强

**Commit**: `a787d57` - chore: 保存当前 UI 重构快照

---

### 2024-02-11

#### 多语言与界面交互增强
- 实现完整的中英文国际化支持
- 添加语言切换功能
- 优化界面交互体验
- 改进用户反馈机制

**Commit**: `fc4f701` - feat: 完成多语言与界面交互增强改造

#### 代理配置修复
- 修复代理配置误用问题
- 完善配置持久化逻辑
- 确保代理设置正确应用

**Commit**: `a722e6e` - fix: 修复代理误用与配置持久化逻辑

#### 卡片更新和编辑功能
- 实现卡片更新模式（create_only、update_only、create_or_update）
- 添加逐张卡片编辑功能
- 集成 Markdown 语法高亮
- 改进卡片展示界面

**Commit**: `8db934a` - feat: 阶段二三大功能 — 卡片更新、逐张编辑、Markdown语法高亮

#### OCR 进度显示
- 添加 OCR 逐页进度回调
- 实现 UI 实时状态显示
- 改进用户体验

**Commit**: `f72fc40` - feat: 添加OCR逐页进度回调与UI实时状态显示

#### MVP 稳定性修复
- 完成 MVP 版本稳定性修复
- 实现 OCR 模型按需下载流程
- 优化首次使用体验

**Commit**: `16da339` - feat: 完成MVP稳定性修复与OCR按需下载流程

#### OCR 引擎升级
- 升级到 PP-OCRv5 模型
- 切换到 predict 接口
- 提升识别准确率

**Commit**: `3699e99` - fix(ocr): 升级到PP-OCRv5并切换predict接口

#### 性能统计面板
- 添加性能统计面板入口
- 支持查看详细性能指标
- 便于性能分析和优化

**Commit**: `d27f635` - feat: 添加性能统计面板入口

#### 文档解析增强
- 增强 Docx 样式解析
- 增强 Pptx 层级解析
- 改进文档结构识别

**Commit**: `8ed4869` - feat: 增强Docx和Pptx样式与层级解析

#### DeepSeek 支持和 OCR 纠错
- 添加 DeepSeek 提供商配置
- 实现 OCR 纠错功能
- 支持更新模式选择

**Commit**: `fa12f41` - feat: 支持DeepSeek配置与OCR纠错及更新模式

#### 转换和查重优化
- 修复转换缺失文件问题
- 更新查重范围配置
- 完善异步指标收集

**Commit**: `65587a8` - fix: 修复转换缺失文件与更新查重范围并完善异步指标

#### OCR 性能优化
- 优化 OCR 预热流程
- 改进批量转换缓存
- 提升并发处理性能

**Commit**: `ef459ff` - perf: 优化OCR预热与批量转换缓存并发

#### 新增卡片策略
- 添加概念解释策略
- 添加关键术语策略
- 丰富卡片生成选项

**Commit**: `664d9fc` - feat: 新增概念解释与关键术语卡片策略

#### APKG 媒体支持
- 支持 APKG 打包 data 和 url 媒体附件
- 自动下载 URL 媒体
- 处理 Base64 编码媒体

**Commit**: `0e73a4e` - fix: 支持APKG打包data和url媒体附件

---

### 2024-02-10

#### 项目初始化
- 初始化项目结构
- 同步当前实现
- 建立基础架构

**Commit**: `caa7fad` - chore: 初始化项目文件并同步当前实现

#### 预览和 APKG 修复
- 修复预览页面加载问题
- 修复 APKG 媒体打包问题
- 改进错误处理

**Commit**: `317d0f5` - fix: 修复预览加载与APKG媒体打包

---

## 已知问题

### v0.1.0

1. **OCR 识别准确率**
   - 对于复杂排版的文档，OCR 识别可能不够准确
   - 建议启用 OCR 纠错功能

2. **长文档处理**
   - 超长文档（>100 页）可能导致内存占用较高
   - 建议启用自动分割功能

3. **LLM 响应时间**
   - 某些 LLM 提供商响应较慢
   - 建议配置合理的超时时间

4. **UI 响应性**
   - 在处理大量卡片时，UI 可能出现短暂卡顿
   - 已使用异步处理，但仍有优化空间

---

## 路线图

### v0.2.0 (计划中)

- [ ] 支持更多文档格式
  - EPUB 电子书
  - HTML 网页
  - CSV/Excel 表格
- [ ] 支持更多卡片类型
  - Audio 卡片
  - Video 卡片
  - Image Occlusion Enhanced
- [ ] 批量操作优化
  - 批量编辑卡片
  - 批量应用标签
  - 批量修改牌组
- [ ] 性能优化
  - 减少内存占用
  - 加快转换速度
  - 优化 UI 响应性
- [ ] 用户体验改进
  - 添加快捷键支持
  - 改进错误提示
  - 添加使用教程

### v0.3.0 (计划中)

- [ ] 插件系统
  - 支持自定义转换器
  - 支持自定义卡片策略
  - 支持自定义 UI 主题
- [ ] 云端同步
  - 配置云端备份
  - 卡片历史记录
  - 多设备同步
- [ ] 协作功能
  - 分享卡片集
  - 协作编辑
  - 评论和反馈
- [ ] Web 版本
  - 浏览器端运行
  - 无需安装
  - 跨平台支持

### 长期规划

- [ ] 移动端应用 (iOS/Android)
- [ ] 浏览器插件
- [ ] API 服务
- [ ] 社区卡片库
- [ ] AI 辅助学习建议

---

## 贡献者

感谢所有为 Ankismart 做出贡献的开发者！

---

## 反馈和建议

如果你有任何问题、建议或功能请求，请通过以下方式联系我们：

- **GitHub Issues**: 报告 Bug 或提出功能请求
- **GitHub Discussions**: 讨论和提问
- **Email**: [联系我们]

---

## 许可证

Ankismart 采用 [GPLv3 License](../LICENSE) 开源。

---

**注意**: 本项目仍在积极开发中，API 可能会发生变化。建议在生产环境使用前进行充分测试。
